{
  "id": "c-day68-ex00-ft-env-init",
  "category": "c",
  "day": 68,
  "order": 0,
  "title": "Copier les variables d'environnement",
  "description": "Ecris la fonction ft_env_init qui copie les variables d'environnement du programme (envp) dans un tableau dynamique que le shell pourra modifier. Chaque variable (format KEY=VALUE) est dupliquee avec strdup. Le tableau est termine par NULL. Cette copie est necessaire car on doit pouvoir ajouter et supprimer des variables.",
  "difficulty": 4,
  "points": 40,
  "estimatedTime": 30,
  "learningObjectives": [
    "Comprendre le format des variables d'environnement (KEY=VALUE)",
    "Copier envp dans un nouveau tableau dynamique",
    "Dupliquer chaque variable avec strdup",
    "Gerer les erreurs d'allocation",
    "Comprendre pourquoi il faut une copie (modifications futures)"
  ],
  "learningContent": {
    "lesson": {
      "introduction": "Cet exercice fait partie du module Minishell : Environnement. Ecris la fonction ft_env_init qui copie les variables d'environnement du programme (envp) dans un tableau dynamique que le shell pourra modifier. Chaque variable (format KEY=VALUE) est dupliquee avec strdup. Le tableau est termine par NULL. Cette copie est necessaire car on doit pouvoir ajouter et supprimer des variables.",
      "steps": [
        {
          "id": 1,
          "title": "Analyse du probleme",
          "content": "L'objectif est de copier les variables d'environnement. Analysons les differents aspects du probleme et les fonctions systeme necessaires.",
          "codeExample": "// Prototype de la fonction :\n// Voir le starterCode pour le prototype exact",
          "language": "c",
          "tryItYourself": {
            "instruction": "Quelles sont les etapes principales pour copier les variables d'environnement ?",
            "starterCode": "// Etape 1 : ???\n// Etape 2 : ???\n// Etape 3 : ???",
            "solution": "// Etape 1 : Parser les arguments\n// Etape 2 : Appeler les fonctions systeme\n// Etape 3 : Gerer les erreurs et retourner le resultat"
          }
        },
        {
          "id": 2,
          "title": "Fonctions systeme necessaires",
          "content": "Pour copier les variables d'environnement, nous utilisons les fonctions : malloc, free, strdup. Chacune a un role specifique dans l'implementation.",
          "codeExample": "// Fonctions utilisees :\n// // - malloc\n// - free\n// - strdup\n// - write",
          "language": "c",
          "tryItYourself": {
            "instruction": "Que retourne malloc() en cas d'erreur ?",
            "starterCode": "// malloc() en cas d'erreur retourne : ???",
            "solution": "// malloc() retourne -1 ou NULL en cas d'erreur\n// Il faut toujours verifier le retour"
          }
        },
        {
          "id": 3,
          "title": "Implementation pas a pas",
          "content": "Implementons la fonction etape par etape, en gerant chaque cas et chaque erreur possible.",
          "codeExample": "// Structure de l'implementation :\n// 1. Verifier les arguments\n// 2. Effectuer l'operation principale\n// 3. Gerer le resultat et les erreurs\n// 4. Retourner le code de succes ou d'erreur",
          "language": "c",
          "tryItYourself": {
            "instruction": "Quel est le code de retour en cas de succes ? Et en cas d'erreur ?",
            "starterCode": "// Succes : retourne ???\n// Erreur : retourne ???",
            "solution": "// Succes : retourne 0\n// Erreur : retourne 1 (ou -1 selon la convention)"
          }
        },
        {
          "id": 4,
          "title": "Solution complete et tests",
          "content": "Voici la solution complete de copier les variables d'environnement avec tous les cas geres. Testez avec differents arguments pour verifier le comportement.",
          "codeExample": "// La solution complete est dans le champ 'solution'\n// Testez avec : cas normal, cas limite, erreur",
          "language": "c"
        }
      ]
    },
    "theory": [
      {
        "title": "Variables d'environnement en C",
        "content": "Les variables d'environnement sont passees au programme via le troisieme argument de main (envp) ou accessibles via environ. Chaque variable est une chaine au format KEY=VALUE.",
        "codeExamples": [
          {
            "title": "Exemple : Variables d'environnement en C",
            "code": "// Illustration de variables d'environnement en c\n// Code d'exemple contextuel",
            "explanation": "Ce concept est essentiel pour copier les variables d'environnement."
          }
        ],
        "keyPoints": [
          "Le concept de variables d'environnement en c est fondamental en C",
          "Il permet de gerer correctement les ressources",
          "Il est utilise dans de nombreux projets 42",
          "Maitriser ce concept est essentiel pour minishell"
        ],
        "commonMistakes": [
          "Ne pas verifier les retours d'erreur lies a variables d'environnement en c",
          "Oublier de liberer les ressources apres utilisation",
          "Confondre les differents cas d'utilisation"
        ]
      },
      {
        "title": "Le tableau envp",
        "content": "envp est un tableau de chaines termine par NULL. Chaque chaine a le format 'KEY=VALUE'. Le shell doit avoir sa propre copie pour pouvoir la modifier avec export et unset.",
        "codeExamples": [
          {
            "title": "Exemple : Le tableau envp",
            "code": "// Illustration de le tableau envp\n// Code d'exemple contextuel",
            "explanation": "Ce concept est essentiel pour copier les variables d'environnement."
          }
        ],
        "keyPoints": [
          "Le concept de le tableau envp est fondamental en C",
          "Il permet de gerer correctement les ressources",
          "Il est utilise dans de nombreux projets 42",
          "Maitriser ce concept est essentiel pour minishell"
        ],
        "commonMistakes": [
          "Ne pas verifier les retours d'erreur lies a le tableau envp",
          "Oublier de liberer les ressources apres utilisation",
          "Confondre les differents cas d'utilisation"
        ]
      },
      {
        "title": "Parsing KEY=VALUE",
        "content": "Pour parser une variable, on cherche le premier '=' avec strchr. Tout avant est la cle, tout apres est la valeur. Attention aux cas sans '=' (export sans valeur).",
        "codeExamples": [
          {
            "title": "Exemple : Parsing KEY=VALUE",
            "code": "// Illustration de parsing key=value\n// Code d'exemple contextuel",
            "explanation": "Ce concept est essentiel pour copier les variables d'environnement."
          }
        ],
        "keyPoints": [
          "Le concept de parsing key=value est fondamental en C",
          "Il permet de gerer correctement les ressources",
          "Il est utilise dans de nombreux projets 42",
          "Maitriser ce concept est essentiel pour minishell"
        ],
        "commonMistakes": [
          "Ne pas verifier les retours d'erreur lies a parsing key=value",
          "Oublier de liberer les ressources apres utilisation",
          "Confondre les differents cas d'utilisation"
        ]
      },
      {
        "title": "Reallocation de tableau",
        "content": "Pour ajouter une variable, il faut agrandir le tableau avec realloc ou malloc+copie. Le nouveau tableau doit avoir une place supplementaire pour la nouvelle variable et le NULL final.",
        "codeExamples": [
          {
            "title": "Exemple : Reallocation de tableau",
            "code": "// Illustration de reallocation de tableau\n// Code d'exemple contextuel",
            "explanation": "Ce concept est essentiel pour copier les variables d'environnement."
          }
        ],
        "keyPoints": [
          "Le concept de reallocation de tableau est fondamental en C",
          "Il permet de gerer correctement les ressources",
          "Il est utilise dans de nombreux projets 42",
          "Maitriser ce concept est essentiel pour minishell"
        ],
        "commonMistakes": [
          "Ne pas verifier les retours d'erreur lies a reallocation de tableau",
          "Oublier de liberer les ressources apres utilisation",
          "Confondre les differents cas d'utilisation"
        ]
      }
    ],
    "prepExercises": [
      {
        "id": 1,
        "title": "Comprendre Copier",
        "instruction": "Explique le fonctionnement de base de copier les variables d'environnement.",
        "starterCode": "// Explique le concept",
        "solution": "// Le concept est explique dans la theorie",
        "hint": "Relis la section theorie pour les details.",
        "difficulty": 1
      },
      {
        "id": 2,
        "title": "Cas de base",
        "instruction": "Ecris le cas de base (cas le plus simple) de la fonction.",
        "starterCode": "// Gere le cas le plus simple",
        "solution": "// Le cas de base est quand il n'y a rien a faire\n// Retourner 0 ou NULL selon le contexte",
        "hint": "Commence par gerer le cas NULL ou vide.",
        "difficulty": 1
      },
      {
        "id": 3,
        "title": "Cas normal",
        "instruction": "Ecris le code pour le cas normal (arguments valides).",
        "starterCode": "// Traite le cas standard",
        "solution": "// Voir la solution complete de l'exercice",
        "hint": "Suis l'algorithme decrit dans la lecon.",
        "difficulty": 2
      },
      {
        "id": 4,
        "title": "Gestion d'erreurs",
        "instruction": "Ajoute la gestion des erreurs a la fonction.",
        "starterCode": "// Ajoute les verifications d'erreur",
        "solution": "// Verifie chaque appel systeme et retourne une erreur appropriee",
        "hint": "Chaque appel systeme peut echouer. Verifie le retour.",
        "difficulty": 2
      },
      {
        "id": 5,
        "title": "Test complet",
        "instruction": "Ecris un main qui teste copier les variables d'environnement avec differents cas.",
        "starterCode": "int main(void)\n{\n\t// Teste la fonction\n\treturn (0);\n}",
        "solution": "int main(void)\n{\n\t// Test avec cas normal, cas limite, et erreur\n\treturn (0);\n}",
        "hint": "Teste au moins 3 cas : normal, limite, et erreur.",
        "difficulty": 2
      }
    ]
  },
  "starterCode": "#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\n// Prototype et structure a completer\n// Copier les variables d'environnement\n",
  "solution": "#include <unistd.h>\n#include <stdlib.h>\n#include <string.h>\n\n// Solution complete de Copier les variables d'environnement\n// Voir la lecon pour l'implementation detaillee\n",
  "hints": [
    "Commence par gerer le cas le plus simple pour copier les variables d'environnement.",
    "Utilise malloc comme fonction principale de l'implementation.",
    "N'oublie pas de gerer tous les cas d'erreur et de liberer la memoire."
  ],
  "testCases": [
    {
      "id": 1,
      "description": "Copie de envp preservee",
      "stdin": "",
      "expectedStdout": "PATH=/usr/bin\n",
      "expectedExitCode": 0,
      "visible": true
    },
    {
      "id": 2,
      "description": "Nombre de variables correct",
      "stdin": "",
      "expectedStdout": "count=42\n",
      "expectedExitCode": 0,
      "visible": false
    },
    {
      "id": 3,
      "description": "Tableau termine par NULL",
      "stdin": "",
      "expectedStdout": "last=NULL\n",
      "expectedExitCode": 0,
      "visible": false
    }
  ],
  "constraints": {
    "allowedFunctions": [
      "malloc",
      "free",
      "strdup",
      "write"
    ],
    "forbiddenFunctions": [
      "printf",
      "system"
    ],
    "maxExecutionTime": 5000,
    "maxMemory": 128
  },
  "relatedExercises": [
    "c-day68-ex01-ft-builtin-export",
    "c-day68-ex02-ft-builtin-unset"
  ],
  "resources": [
    {
      "title": "Minishell : Environnement - Guide complet",
      "url": "https://www.geeksforgeeks.org/making-linux-shell-c/",
      "type": "documentation"
    },
    {
      "title": "Fonctions systeme pour copier",
      "url": "https://man7.org/linux/man-pages/",
      "type": "article"
    }
  ]
}